# 📘 iOS 技术说明书 --- SunnyPet MVP

**App 名称：** SunnyPet\
**平台：** iOS 17+\
**语言/框架：** Swift + SwiftUI + MVVM + SwiftData\
**开发目标：** 构建一款天气驱动任务打卡 + 虚拟宠物陪伴应用\
**版本范围：** MVP 可运行闭环（任务→奖励→宠物反馈→商店消费）

## 🧩 1. 总体架构与文件分层

  ------------------------------------------------------------------------------------------------------------------------------------------------------------
  层级                文件路径示例                            职责说明                                                 验收标准
  ------------------- --------------------------------------- -------------------------------------------------------- ---------------------------------------
  **App 层**          `App/SunnyPetApp.swift`                 App 主入口；加载 SwiftData                               App 能正常启动，显示 HomeView。
                                                              容器，注册依赖，决定首页视图。                           

  **Core/Models**     `/Core/Models/*.swift`                  定义任务、宠物、物品、用户统计等核心数据结构。           所有模型可持久化（SwiftData），字段与
                                                                                                                       PRD 对应。

  **Core/Services**   `/Core/Services/*.swift`                承载业务逻辑（任务生成、奖励规则、宠物状态、通知等）。   所有逻辑与 UI 解耦，可独立单元测试。

  **Features/**       `/Features/<Module>/View + ViewModel`   各界面模块（任务、宠物、商店、我的等）。                 视图可运行、数据状态可响应更新。

  **UIComponents/**   `/UIComponents/*.swift`                 通用 UI 组件（按钮、进度条、卡片）。                     组件复用率 ≥ 2 处，样式统一。
  ------------------------------------------------------------------------------------------------------------------------------------------------------------

## 🧱 2. 数据模型层（Models）

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  模块               文件路径                           字段与要求                                                                验收标准
  ------------------ ---------------------------------- ------------------------------------------------------------------------- ------------------------------------------------
  **Task**           `Core/Models/Task.swift`           `id, title, weatherType, difficulty, date, status`；枚举 `WeatherType`,   能创建任务对象、标记完成状态；当日任务能筛选。
                                                        `TaskStatus`。                                                            

  **TaskTemplate**   `Core/Models/TaskTemplate.swift`   模板定义：`title, weatherType, difficulty, indoor/outdoor`。              TaskGenerator 可读取模板生成任务。

  **Pet**            `Core/Models/Pet.swift`            `name, mood, hunger, level, xp, decorations[]`。                          宠物心情/饱食度能更新并持久化。

  **Item**           `Core/Models/Item.swift`           `sku, type, name, costEnergy, relationshipBoost`。                   可用于购买/喂食逻辑。

  **UserStats**      `Core/Models/UserStats.swift`      `totalEnergy, coins, streakDays, lastActiveDate, completedTasksCount`。   能记录连续天数、能量值、用户情绪变化。
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

## ⚙️ 3. 服务层（Services）

  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------
  服务模块                   文件路径                                     功能要求                                         验收标准
  -------------------------- -------------------------------------------- ------------------------------------------------ ----------------------------------------------
  **StorageService**         `Core/Services/StorageService.swift`         初始化 SwiftData；提供通用 CRUD；创建默认 Pet /  App 首次启动自动生成默认宠物与用户记录。
                                                                          UserStats。                                      

  **TaskGeneratorService**   `Core/Services/TaskGeneratorService.swift`   根据天气和历史任务生成今日任务；避免重复。每天仅生成一批新任务；不同天气模板正确切换。
                                                                          项任务。                                         

  **RewardEngine**           `Core/Services/RewardEngine.swift`           定义奖励规则：完成任务 +10 能量，全清 +streak    任务完成后能量更新正确；全清任务显示连击+1。
                                                                          奖励；购买扣费。                                 

  **PetEngine**              `Core/Services/PetEngine.swift`              处理宠物每日结算、喂食、摸头、装备装扮等逻辑。   完成任务后宠物心情随之变化；喂食有效果。

  **NotificationService**    `Core/Services/NotificationService.swift`    请求通知权限；安排每日中不同时间段根据天气进行时间加权随机的提醒。       本地通知能按时触发；未授权时有 fallback 提示。

  **WeatherService**         `Core/Services/WeatherService.swift`         MVP 可随机生成天气；后续接入 WeatherKit。        每次启动天气类型能返回随机枚举。

  **ChatService**            `Core/Services/ChatService.swift`            封装 AI 聊天；MVP 返回固定回复。                 调用接口可返回字符串回复，不崩溃。

  **AnalyticsService**       `Core/Services/AnalyticsService.swift`       记录事件：任务完成、商店购买、宠物互动。         控制台能看到日志输出。
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------

## 🧩 4. 各功能模块（Features）

  -------------------------------------------------------------------------------------------------------------------------------------
  模块               文件路径                  主要界面逻辑                                      验收标准
  ------------------ ------------------------- ------------------------------------------------- --------------------------------------
  **Onboarding**     `/Features/Onboarding/`   展示欢迎界面；选择昵称/地区；请求通知授权。       用户首次启动能完成引导，进入 Home。

  **Home**           `/Features/Home/`         今日任务进度、宠物简述、快捷入口。                能显示任务完成率与宠物状态摘要。

  **Tasks**          `/Features/Tasks/`        展示今日任务；切换完成状态；显示奖励动画。        任务点击后状态切换、能量即时更新。

  **Pet**            `/Features/Pet/`          展示宠物形象、心情、关系；交互（摸头/喂食）。   点击交互宠物表情或数据实时变化。

  **Shop**           `/Features/Shop/`         展示物品列表；购买/扣费逻辑；提示余额不足。       购买后能量或金币减少；宠物属性更新。

  **Profile (我的)** `/Features/Profile/`      展示 streak、累计任务数、设置通知开关。           数据与 UserStats
                                                                                                 一致；通知开关能同步系统。

  **Chat（占位）**   `/Features/Chat/`         宠物聊天界面；MVP 返回固定话术。                  输入后能显示回复；界面稳定不崩溃。
  -------------------------------------------------------------------------------------------------------------------------------------

## ✅ 12. MVP 验收 checklist（汇总）

  类别          验收点                               状态
  ------------- ------------------------------------ ------
  🎯 启动流程   App 能启动并创建默认宠物与任务       ☐
  📋 任务系统   每日任务显示、可完成、能量奖励正确   ☐
  🐶 宠物系统   宠物心情与饱食度联动正常             ☐
  🏪 商店系统   购买逻辑与扣费规则正确               ☐
  ⏰ 通知       每天两次提醒正常推送                 ☐
  💾 数据持久   重启后数据一致                       ☐
  🔢 奖励机制   连击逻辑正确计算                     ☐
  🧠 AI 占位    Chat 模块可输入并返回固定回复        ☐
  ☀️ 天气模块   随机天气影响任务模板                 ☐
  📊 埋点       控制台输出关键事件                   ☐
