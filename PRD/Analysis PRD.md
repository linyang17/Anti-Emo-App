# 统计分析PRD

Status: Not started
Priority: Core
Created: 9 November 2025 15:25
Last edited: 17 November 2025 11:01
Tasks: 优化数据和权限部分的structure和性能 (https://www.notion.so/structure-2a99ab714701801c8d83fd267c1cb9e7?pvs=21)

能量值（Energy System）包括完整的**时间序列数据结构**：

- 每次记录有时间戳（DateTime）

- 变化量（增加/消耗）

情绪系统（Mood System）包括完整的**时间序列数据结构**：

- 每次记录有时间戳（DateTime）

- 当前情绪值

大致可以分为「基础指标区」「趋势区」「AI建议区」三块。其中数据分析主要围绕：

情绪：平均值（每日/每周/历史）

能量：增加值（当天总增加/一周内每天的总增加/历史日均增加）——只关心变化>0的数据（反映任务完成情况）

**带*的为后期扩展（当前不做）**

---

# 用户端

### 情绪统计页面展示dashboards：

1. 文字：
    1. **当天数值汇总：当前**数值，过去一周平均
    2. AI建议
2. 柱状图
    1. 趋势（历史数值）：tab：日/周/月
    2. 天气vs情绪均值
3. 热力图
    1. 时间段+星期几 vs 情绪均值
4. 折线图
    1. 日照时长vs情绪均值

### 能量统计页面展示dashboards（仅关注增长的情况）：

1. 文字：
    1. **当天数值汇总：**今日增长数值，今日完成任务数量，过去一周平均增长数值，过去一周平均完成数量
    2. AI建议
2. 柱状图
    1. 趋势（历史数值）：tab：日/周/月
3. 饼图
    1. 完成任务各个类型占比

### 基础数值

> 用来理解用户当前状态与总体趋势
> 

| 统计类型 | 情绪/能量增长示例 | 价值 |
| --- | --- | --- |
| **当天数值汇总** | 今日平均情绪值70/100，今日能量增长总数24 | 判断当天心情和任务完成情况 |
| **当天各时段数值** | 按照小时aggregate | 显示当天不同时段心情和任务完成情况 |
| **历史日均（周/月）** | 最近一周日均情绪 65，日均能量增长15 | 直方图，显示趋势，判断历史心情和任务完成情况 |

---

### 规律分析

> 用于发现”什么时候”用户情绪最容易变化和任务完成情况。
情绪低落的时候需要推送更多任务或者关怀提醒。
> 

| 分析维度 | 示例 | 价值 |
| --- | --- | --- |
| **时段分析** | 上午 vs 下午 vs 晚上，周一到周日。（柱状图）
若早上情绪随之下降 → 推测起床后疲劳（文字） | 分别找出哪个时段和星期几”用户最需要关怀，AI模型可生成干预建议 |
| **天气关联度** | 阴雨天情绪均值44；晴天77 | 反映天气对用户情绪影响 |
| **日照时长分析（seasonality）** | 根据日出日落区分白天和黑夜。不同日照时长的情绪平均（白天6-6.5h时平均情绪52） | 反映不同季节（日照时长）对情绪平均值的影响 |
| **任务类型完成比** | 饼图。完成户外任务占所有完成任务的百分比 | 反映用户的任务类型偏好 |

### 高级分析和个性化*

> 提供AI化、个性化的反馈或预测模型输入
> 

| 分析方向 | 示例 | 价值 |
| --- | --- | --- |
| **异常检测** | 一天情绪下降>1σ 触发”情绪警报” | 衡量波动和稳定性，触发关怀通知 |
| **个体基线分析** | 建立用户”正常情绪范围” | 识别异常波动、AI自适应提醒频率 |
| **预测趋势** | 用ARIMA/LSTM预测下周平均情绪 | 用于个性化预警与推荐 |
| **情绪恢复速度** | 从情绪低谷到回到均值的平均天数 | 评估心理恢复力（resilience） |

---

# 开发者端

### 任务完成度分析

> ”什么时候”用户完成任务更多。
这个分析主要收集汇总所有用户数据给开发者，用于增强用户参与度。不提供给用户。
**TBC：**用能量增长值还是任务完成度。注意不同类型的任务会加不同数值的能量。
> 

| 分析维度 | 示例 | 价值 |
| --- | --- | --- |
| **时段分析** | 上午 vs 下午 vs 晚上，周一到周日 | 找出用户”最活跃时段”和星期几最活跃 |
| **日照时长分析** | 根据日出日落区分白天和黑夜。不同日照时长的情况（<6h, 6-8h等） | 反馈不同日照时长对用户任务完成度的影响 |
| **任务类型完成比** | 饼图。所有用户的完成户外任务占全部完成任务的百分比 | 显示所有用户对任务类型的偏好 |
| **天气+任务类型关联*** | 多云情况下户外任务整体完成度 vs 发布总数 | 反馈不同天气情况下任务参与度和用户偏好 |

### 关联度分析

> 找出天气、能量与情绪的互动关系和驱动因子，验证任务激励效果
这个分析主要收集汇总所有用户数据给开发者
> 

| 分析类型 | 示例 | 价值 |
| --- | --- | --- |
| **情绪与能量相关系数** | corr(mood, energy) = 0.68 | 判断两者关联强度 |
| **任务完成后情绪即时反馈** | 完成不同类型的任务前后情绪变化 | 验证不同类型的任务有效性，后续可用来优化推荐算法 |
| **任务完成率与情绪改善** | 完成任务越多，平均情绪值越高 | 验证任务激励效果 |
| **天气和情绪关联度分析** | 阴雨天情绪均值44；晴天77 | 统计数据验证天气影响 |
| **能量消耗模式** | 若早上能量下降、情绪随之下降 →
推测起床后疲劳 | AI模型可生成干预建议 |
| **滞后分析（Lag Correlation）** | 昨日能量↑ → 今日情绪↑0.5 | 提示因果路径 |
| **天气+任务类型关联*** | 多云情况下户外任务整体完成度 vs 发布总数 | 反馈不同天气情况下任务参与度和用户偏好 |

---

## **保存在本地的数据（给单个用户用）**

> 用来画 PRD 里的「个人情绪趋势、能量趋势、pet 状态、任务历史」，只在本机保存。不需要把这些原始数据上传给服务器。
> 

**1. 本地情绪时间序列**

- timestamp（精确到分钟）
- mood_score
- source（app_open / after_task）
- delta：完成任务后的情绪变化
- related_task_category：情绪变化相关的任务分类

**2. 本地任务 & 能量变化**

- task_local_id
- task_type：outdoor / indoorDigital / …
- timeslot_weather：任务生成时的天气分类
- status：completed / expired
- complete_time（精确到分钟）
- energy_reward：5 / 10 / 15 …

**4. 日照时长**

- date
- day_length：当天日出到日落的时长

**3. 本地宠物状态（只给渲染 UI 用）**

- bonding_value：当前关系值
- exp：当前经验值
- level：等级
- inventory：本地物品（食物、装扮）

## **上传到后端的数据（全量行为分析用）**

> 维度（用户 + 哪天 + 哪个时段 + 天气 + 情绪 + 任务 + 能量增长）
> 

### **1. 用户信息**

- account email （user_id）
- country_region（不用太精确，颗粒度到省（eg. Greater London）就可以，用于季节和日照差异分析）

### **2. 按日期和时间段聚合的行为 & 情绪数据**

**一条记录 = 某个用户在某一天各个时段的压缩统计**。示例结构：

- user_id
- date（按用户本地时区）
- day_length（日出到日落时长）

**当天各个时间段聚合：**

- time_slot
- timeslot_weather（任务生成时的天气）
- count_mood：该时段内的情绪记录个数
- avg_mood：该时段内情绪平均值
- total_energy_gain：时间段内总共增加的能量
- task_type：outdoor / indoorDigital / …
- tasks_completed_total_by_type：可以和task_type合并压缩字段，比如：{ "outdoor": [2,3], "physical": [1,1], ... }
    - [2,3] 表示发布3个完成2个
- mood_delta_after_tasks：该时段内完成每类任务后的平均情绪变化值

### 数据流示意

**本地：**

- 持有完整事件日志（情绪记录、任务完成记录、天气）
- 每天（或每几个小时）执行一次聚合逻辑：
    - 按 `date + time_slot` 分组
    - 算出上面那些指标
- 生成 `user_timeslot_summary` 一个批次的记录

**上传：**

- 只上传这些 summary（每天 4 条时段记录）