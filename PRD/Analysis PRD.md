# 统计分析PRD

Tasks: 优化数据和权限部分的structure和性能 (https://www.notion.so/structure-2a99ab714701801c8d83fd267c1cb9e7?pvs=21)

### 能量值（Energy System）包括完整的**时间序列数据结构**：
- id
- totalEnergy：当前总能量值
- delta：增加量（只记录任务增加的能量值）
- related_task_id

### 任务系统：
- id
- 任务名称
- 任务相关天气
- 任务类别
- energyReward
- date: 时间戳
- 任务状态
- startedAt
- canCompleteAfter：任务时间buffer
- completedAt
- moodEntryId: 情绪反馈记录的id
- isOnboarding: 是否是新手引导任务


### 情绪系统（Mood System）包括完整的**时间序列数据结构**：
- id
- 时间戳精确到分钟
- value：当前情绪值
- source（app_open / after_task / manual）
- delta：完成任务后的情绪变化
- related_task_category
- relatedWeather


大致可以分为「基础指标区」「趋势区」「AI建议区」三块。其中数据分析主要围绕：

- 情绪：平均值（每日/每周/历史）
- 能量：增加值（当天总增加/历史日均增加）——只关心变化>0的数据（反映任务完成情况）


---

# 用户端 

## statistics

### 情绪统计页面展示dashboards：

1. 文字
    1. 当天数值汇总：当前数值，过去一周平均，记录数量
    2. AI建议
2. 柱状图/折线图
    - tab：日/周/月/季（rolling window=1/7/30/91）
    - 天气vs情绪均值
    - 根据窗口聚合和呈现数据

### 能量统计页面展示dashboards（仅关注增长的情况）：

1. 文字
    1. 当天数值汇总：今日增长数值，今日完成任务数量，过去一周平均增长数值，过去一周平均完成数量
    2. AI建议
2. 柱状图
    - tab：日/周/月/季（rolling window=1/7/30/91）
    - 天气vs能量总增长值
    - 和情绪一样，根据窗口聚合和呈现数据
3. 饼图
    1. 完成各个类型任务的占比
    2. 完成总数和未完成总数

### 基础数值分析设计思路

> 帮助用户理解当前状态与总体趋势
> 

| 统计类型 | 情绪/能量增长示例 | 价值 |
| --- | --- | --- |
| **当天数值汇总** | 今日平均情绪值70/100，今日能量增长总数24 | 判断当天心情和任务完成情况 |
| **当天各时段数值** | 按照小时aggregate | 显示当天不同时段心情和任务完成情况 |
| **历史日均（周/月** | 最近一周日均情绪 65，日均能量增长15 | 直方图，显示趋势，判断历史心情和任务完成情况 |

---

## insights

> 规律分析，用于发现”什么时候”用户情绪最容易变化和任务完成情况。
情绪低落的时候需要推送更多任务或者关怀提醒。
> 

### 展示dashboards：

1. 热力图
    - 时间段+星期几 vs 情绪均值
    - 不包括night
2. 柱状图
	- 不同天气的情绪均值
3. 折线图
    - 日照时长vs情绪均值
    - 平滑曲线
    - 自适应xy轴
4. 柱状图
	- 不同任务类型完成后情绪反馈平均值
	- 验证不同类型的任务有效性，后续可用来优化推荐算法

### optional：高级分析和个性化

> 提供AI化、个性化的反馈或预测模型输入
> 

| 分析方向 | 示例 | 价值 |
| --- | --- | --- |
| 异常检测 | 一天情绪下降>1σ 触发”情绪警报” | 衡量波动和稳定性，触发关怀通知 |
| 个体基线分析 | 建立用户”正常情绪范围” | 识别异常波动、AI自适应提醒频率 |
| 预测趋势 | 用ARIMA/LSTM预测下周平均情绪 | 用于个性化预警与推荐 |
| 情绪恢复速度 | 从情绪低谷到回到均值的平均天数 | 评估心理恢复力（resilience） |
| 天气+任务类型关联 | 多云情况下户外任务整体完成度 vs 发布总数 | 反馈不同天气情况下任务参与度和用户偏好 |
| 情绪与能量相关系数 | corr(mood, energy) = 0.68 | 判断两者关联强度 |
| 滞后分析（Lag Correlation | 昨日能量↑ → 今日第一次打开记录的情绪↑0.5 | 提示因果路径 |


---

# optional：开发者端

### 任务完成度分析

> ”什么时候”用户完成任务更多。
这个分析主要收集汇总所有用户数据给开发者，用于增强用户参与度。不提供给用户。
**TBC：**用能量增长值还是任务完成度。注意不同类型的任务会加不同数值的能量。

### 关联度分析

> 找出天气、能量与情绪的互动关系和驱动因子，验证任务激励效果和天气的影响
这个分析主要收集汇总所有用户数据给开发者


---
# 数据流

## 本地：

- 持有完整事件日志（情绪记录、任务完成记录、天气、宠物和商店状态）
	- 用户可以导出和导入完整的历史数据。
- 按日期和时间段聚合的任务和情绪summary：
    - 每个时间段开始时执行一次对上个时间段的聚合逻辑，并且按照以下结构更新当天的对应时段。
    - 一条记录 = 某个用户在某一天各个时段的压缩统计。示例结构：
		- user_id
		- date（按用户本地时区）
		- day_length（日出到日落时长）
		- time_slot
		- timeslot_weather（任务生成时的天气）
		- avg_mood：该时段内情绪平均值
		- task_feedback：任务和类型以及情绪反馈值合并压缩字段。比如：{ "outdoor": [2，1，10], "physical": [1, 1，0]}
			- [2，1，10] 表示发布2个完成1个，情绪反馈总共+10


## 上传到后端的数据（全量行为分析用）

### 1. 用户信息（仅在onboarding结束后上传一次）

- 匿名处理的user_id
- gender
- age_group:18以下，18-24，24-30，30-40，40-50，50-60，60+
- country_region（颗粒度到省或者国家，用于季节和日照差异分析）

### 2. 每天0点上传一次summary
- 如果没有上传成功则保留在本地，上传成功后从本地删除。
